<script>
window.testUrl = "http://www.google.com/";
var benchmarkWindow = 0;

// Define the callback function.
pageFinished = function(load_times) {
  var docLoadTime = Math.round(
    (load_times.finishDocumentLoadTime - load_times.startLoadTime) * 1000.0);
  alert('page load time: ' + docLoadTime);
  chrome.tabs.remove(benchmarkWindow.id, null);
}

// Add a listener for messages from script.js.
chrome.extension.onConnect.addListener(function(port) {
  port.onMessage.addListener(function(data) {
    if (data.message == "load") {
      pageFinished(data.values);
    }
  });
});


// Create a new tab with the test-url and inject script.js.
chrome.tabs.create({"url": window.testUrl,"selected": true},
function(tab) {
  benchmarkWindow = tab;
  // script.js only executes on tested pages
  // not the ones opened by the user.
  chrome.tabs.executeScript(tab.id, {file: "script.js"});
});
</script>
